var GOFOURTH={},C_WIDTH=500,C_HEIGHT=C_WIDTH,headerHeight=80,midX=C_WIDTH/2,midY=(headerHeight+C_HEIGHT)/2,ctx,LEVELS=[{question:"sqrt(5! + (-1))",choices:[22,12,5,11],answer:11},{question:"7!/6!",choices:[1,7,42,6],answer:7}];GOFOURTH.game=function(){function a(a){b(a),u=$("#canvas"),v=u[0],ctx=v.getContext("2d"),v.width=C_WIDTH,v.height=C_HEIGHT,g()}function b(a){z=_.map(_.shuffle(a),function(a){return a.choices=_.shuffle(a.choices),a})}function c(){for(var a in D)D[a]=15}function d(){w=v.width/2,x=(v.height-headerHeight)/2,ctx.drawImage(C,0,0,v.width,v.height),ctx.fillStyle="rgba(255,185,15,0."+D.topLeft+")",ctx.fillRect(0,headerHeight,w,x),ctx.fillStyle="rgba(125,38,205,0."+D.topRight+")",ctx.fillRect(w,headerHeight,w,x),ctx.fillStyle="rgba(127,255,0,0."+D.bottomLeft+")",ctx.fillRect(0,midY,w,x),ctx.fillStyle="rgba(205,0,0,0."+D.bottomRight+")",ctx.fillRect(w,midY,w,x),c()}function e(){ctx.drawImage(C,0,0,v.width,v.height),ctx.font="40px Abel",ctx.fillStyle="#bbb",ctx.textAlign="center",ctx.fillText("You Win!",midX,200),ctx.font="22px Abel",ctx.fillText("Score: "+H+"  High Score: "+A,midX,260),ctx.font="18px Abel",ctx.fillText("Play Again (P)",midX,350)}function f(){ctx.drawImage(C,0,0,v.width,v.height),ctx.font="40px Abel",ctx.fillStyle="#bbb",ctx.textAlign="center",ctx.fillText("Game Over!",C_WIDTH/2,200),ctx.font="22px Abel",ctx.fillText("Score: "+H+"  High Score: "+A,midX,260),ctx.font="18px Abel",ctx.fillText("Play Again (P)",midX,350)}function g(){h(),t(),setTimeout(g,B)}function h(){switch(I){case"play":y=z[G],F>0?(keydown.left&&GOFOURTH.rocket.move.left(),keydown.right&&GOFOURTH.rocket.move.right(),keydown.up&&GOFOURTH.rocket.move.up(),keydown.down&&GOFOURTH.rocket.move.down(),keydown.return&&k(),n(GOFOURTH.rocket),F-=1):k();break;case"win":case"lose":H>A&&j(H),keydown.p&&i()}}function i(){GOFOURTH.rocket.reset(),b(z),F=500,H=0,G=0,I="play"}function j(a){A=a,localStorage["gf-top-score"]=a}function k(){return F>490?void 0:m()?l():I="lose"}function l(){return H+=(G+1)*F,G+=1,F=500,z[G]?!0:I="win"}function m(){var a=y.answer;return o(GOFOURTH.rocket)===y.choices.indexOf(a)?!0:!1}function n(a){var b=!1;p(a)?b="topLeft":q(a)?b="topRight":r(a)?b="bottomLeft":s(a)&&(b="bottomRight"),b&&(D[b]=40)}function o(a){return p(a)?0:q(a)?1:s(a)?2:r(a)?3:-1}function p(a){return a.getX()<midX&&a.getY()<midY?!0:void 0}function q(a){return a.getX()>midX&&a.getY()<midY?!0:void 0}function r(a){return a.getX()<midX&&a.getY()>midY?!0:void 0}function s(a){return a.getX()>midX&&a.getY()>midY?!0:void 0}function t(){switch(ctx.clearRect(0,0,v.width,v.height),I){case"play":d(),ctx.font=E.toString()+"px Abel",ctx.fillStyle="#bbb",ctx.textAlign="left",ctx.fillText(y.question,25,headerHeight/2+E/2-3),ctx.textAlign="right",ctx.fillText(F,C_WIDTH-25,headerHeight/2+E/2-3),ctx.textAlign="center",ctx.fillText(y.choices[0],w/2,headerHeight+x/2),ctx.fillText(y.choices[1],midX+w/2,headerHeight+x/2),ctx.fillText(y.choices[2],midX+w/2,midY+x/2),ctx.fillText(y.choices[3],w/2,midY+x/2),GOFOURTH.rocket.draw();break;case"win":e();break;case"lose":f()}}var u,v,w,x,y,z,A,B=30,C=new Image,D={topLeft:15,topRight:15,bottomLeft:15,bottomRight:15},E=24,F=500,G=0,H=0,I="play";return A=localStorage["gf-top-score"]||0,C.onload=function(){d()},C.src="assets/img/background.jpg",{initialize:a}}(),GOFOURTH.rocket=function(){function a(){c=midX,d=midY,e=0}function b(){i&&(ctx.fillStyle="rgba(255,255,255,0.1)",ctx.beginPath(),ctx.arc(c,d,f/1.5,0,2*Math.PI),ctx.fill(),ctx.drawImage(h,e*f,0,f,g,c-f/2,d-g/2,f,g))}var c=midX,d=midY,e=0,f=49,g=49,h=new Image,i=!1;return move={},maxX=C_WIDTH-f/2,minX=f/2,maxY=C_HEIGHT-g/2,minY=headerHeight+g/2,h.onload=function(){i=!0},h.src="assets/img/rocket-sprite.png",move.right=function(){c=c.clamp(c+10,maxX),e=2},move.up=function(){d=d.clamp(minY+10,maxY)-10,e=0},move.left=function(){c=c.clamp(minX+10,maxX)-10,e=3},move.down=function(){d=d.clamp(d+10,maxY),e=1},{draw:b,move:move,reset:a,getX:function(){return c},getY:function(){return d}}}(),$(document).ready(function(){GOFOURTH.game.initialize(LEVELS)}),Number.prototype.clamp=function(a,b){return Math.min(Math.max(this,a),b)};